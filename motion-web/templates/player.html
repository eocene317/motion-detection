<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<!-- Website Design By: www.happyworm.com -->
<title>Bagel's Cam</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="{{ url_for('static', filename='jplayer.blue.monday.min.css') }}" rel="stylesheet" type="text/css" />
<style>.jp-video-480p{width:800px}</style>
<script type="text/javascript" src="{{ url_for('static', filename='jquery.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery.jplayer.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jplayer.playlist.min.js') }}"></script>
<script type="text/javascript">
//<![CDATA[

{% for v in videos %}
	// {{ v }}
{% endfor %}

var myPlaylist;

function save(key, object) {
	localStorage.setItem(key, JSON.stringify(object));
}

function load(key) {
	return JSON.parse(localStorage.getItem(key));
}

function loadPlaylist() {
	$.ajax('/playlist').done(function(playlist) {
		// var playlist = $(data).find('a:contains(".mp4")').map(function(i) {
		// 	var file = $(this).text();
		// 	var m = file.match(/\w*-(\d{4})(\d{2})(\d{2})-(\d{2})(\d{2})(\d{2})-(\d+)\.(\w+)/);
		// 	var video = {
		// 		index: i,
		// 		filename: file,
		// 		date: new Date(m[1], m[2], m[3], m[4], m[5], m[6]),
		// 		duration: parseInt(m[7]),
		// 		m4v: file
		// 	};
		// 	video.title = video.date;
		// 	video.artist = video.duration;
		// 	return video;
		// });

		myPlaylist.setPlaylist(playlist);

		var currentVideo = load('currentVideo');
		if (currentVideo) {
			var candidate = playlist[currentVideo.index];
			if (candidate && candidate.filename == currentVideo.filename) {
				if (currentVideo.ended && myPlaylist.playlist.length - currentVideo.index > 1) {
					myPlaylist.select(currentVideo.index + 1);
				} else {
					myPlaylist.select(currentVideo.index);
				}
			} else {
				localStorage.removeItem('currentVideo');
			}
		}

		// Sroll to Current
		$('li.jp-playlist-current').each(function() { this.scrollIntoView() });

		$('#videoContainer').bind($.jPlayer.event.play, function(e) {
			var currentVideo = playlist[myPlaylist.current];
			save('currentVideo', currentVideo);
		});

		$('#videoContainer').bind($.jPlayer.event.ended, function(e) {
			var currentVideo = load('currentVideo');
			if (currentVideo) {
				currentVideo.ended = true;
				save('currentVideo', currentVideo);
			}
		});
	});
}

$(document).ready(function() {
	myPlaylist = new jPlayerPlaylist({ jPlayer: "#jquery_jplayer_N", cssSelectorAncestor: "#videoContainer" }, [], {
		playlistOptions: {
			displayTime: 0
		},
		supplied: "m4v",
		useStateClassSkin: true,
		autoBlur: false,
		smoothPlayBar: false,
		keyEnabled: false,
		size: {	width: 800, height: 448, cssClass: "jp-video-480p" },
		ready: loadPlaylist
	});
});

//]]>
</script>
</head>
<body>
<div id="videoContainer" class="jp-video" role="application" aria-label="media player">
	<div class="jp-type-playlist">
		<div id="jquery_jplayer_N" class="jp-jplayer"></div>
		<div class="jp-gui">
			<div class="jp-interface">
				<div class="jp-progress">
					<div class="jp-seek-bar">
						<div class="jp-play-bar"></div>
					</div>
				</div>
				<div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>
				<div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>
				<div class="jp-details">
					<div class="jp-title" aria-label="title">&nbsp;</div>
				</div>
				<div class="jp-controls-holder">
					<div class="jp-volume-controls">
						<button class="jp-mute" role="button" tabindex="0">mute</button>
						<button class="jp-volume-max" role="button" tabindex="0">max volume</button>
						<div class="jp-volume-bar">
							<div class="jp-volume-bar-value"></div>
						</div>
					</div>
					<div class="jp-controls">
						<button class="jp-previous" role="button" tabindex="0">previous</button>
						<button class="jp-play" role="button" tabindex="0">play</button>
						<button class="jp-stop" role="button" tabindex="0">stop</button>
						<button class="jp-next" role="button" tabindex="0">next</button>
					</div>
					<div class="jp-toggles">
						<button class="jp-repeat" role="button" tabindex="0">repeat</button>
						<button class="jp-shuffle" role="button" tabindex="0">shuffle</button>
						<button class="jp-full-screen" role="button" tabindex="0">full screen</button>
					</div>
				</div>
			</div>
		</div>
		<div class="jp-playlist" style="max-height: 180px; overflow-y: auto">
			<ul>
				<li></li>
			</ul>
		</div>
	</div>
</div>

</body>

</html>
